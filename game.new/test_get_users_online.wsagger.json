{
  "wsagger": "0.0.3",
  "info": {
      "description": "GBKSOFT chat API",
      "version": "1.0.0",
      "title": "GBKSOFT chat API"
  },

  "REST_" : {
    "dev": { "proto": "https:", "host": "gambling-game-api.dev.gbksoft.net", "port": "443", "path": "/rest" },
    "loc": { "proto": "https:", "host": "gambling-game-api.dev.gbksoft.net", "port": "443", "path": "/rest" }
  },
  
  "user_" : {
    "fenix":      { "username": "stalker.fenix@gmail.com", "password": "123456", "id": "5"},
    "devgbksoft": { "username": "devgbksoft@gmail.com",    "password": "123456", "id": "4"}
  },
  
  "server_" : {
    "dev":  { "proto": "socket.io", "host": "gambling-game-node.dev.gbksoft.net", "port": "28790", "path": "/front_space" },
    "loc":  { "proto": "socket.io", "host": "127.0.0.1",                          "port": "28780", "path": "/front_space" }
  },

  "scenarios": [
    {
      "name": "connect to socket.io without token",
      "parameters": [
      ],
          
      "flow": [
        { 
          "action": "socket_io.connect",           
          "wait": {"delay": 3000}, 
          "expected": [[ "CID", {"CID_rest": "{{!CID_rest}}", "CID_node": "{{!CID_node}}"}]],
          "data": { 
            "url": "http://{{server.host}}:{{server.port}}{{server.path}}",            
            "query": {}
          }         
        },

        { 
          "action": "https.request",           
          "data": {
            "method": "POST", 
            "host": "{{REST.host}}", 
            "port": "{{REST.port}}", 
            "path": "{{REST.path}}/v1/users/login", 
            "headers": {"Content-Type": "application/x-www-form-urlencoded", "Accept": "application/json"},
            "queryData":"email={{user.username}}&password={{user.password}}"
          },          
          "wait": {"delay": 5000},           
          "expected": { "result": { "accessToken": {"token": "{{!token}}"}}}
        },

        { 
          "action": "https.request",           
          "data": {
            "method": "POST", 
            "host": "{{REST.host}}", 
            "port": "{{REST.port}}", 
            "path": "{{REST.path}}/v1/connections", 
            "headers": {"Content-Type": "application/json", "Accept": "application/json", "Authorization": "Bearer {{token}}"},
            "queryData":"{\"connection_id\": \"{{CID_rest}}\"}"
          },          
          "wait": { "delay": 5000 },
          "expected": { "code": 200 }
        },

        { 
          "action": "exec.execSync",            
          "wait": {"delay": 7000}, 
          "expected": { "facebookFriends": [] },
          "data": [
          	{
              "action": "socket_io.connect",           
              "wait": {"delay": 3000}, 
              "expected": [[ "connectedTo", {}]],
              "data": { 
                "url": "http://{{server.host}}:{{server.port}}{{server.path}}",            
                "query": { "query": "token={{CID_node}}{{token}}" }
              }         
            },

            {
              "action": "socket_io.emit",
              "data": ["getUsersOnline", { "type": "facebook" }],
              "wait": { "delay": 3000 },
              "expected": [[ "usersOnline", { "type": "facebook", "userIds": "{{!facebookFriends}}" } ]]
            }

          ]
        }  
      ]
    }
  ]  
}

