{
  "wsagger": "0.0.3",
  "info": {
    "description": "GBKSOFT chat API",
    "version": "1.1.0",
    "title": "GBKSOFT chat API"
  },

  "REST_" : {
    "loc":  { "proto": "http://", "host": "localhost",                    "port": "28780", "path": "/rest" },
    "dev":  { "proto": "http://", "host": "chat-nodejs.dev.gbksoft.net",  "port": "28781", "path": "/rest" },
    "test": { "proto": "http://", "host": "chat-nodejs.test.gbksoft.net", "port": "28782", "path": "/rest" },
    "live": { "proto": "http://", "host": "chat-nodejs.live.gbksoft.net", "port": "28783", "path": "/rest" }
  },

  "server_" : {
    "loc":  { "proto": "socket.io", "host": "127.0.0.1",                    "port": "28780", "path": "/front_space" },
    "dev":  { "proto": "socket.io", "host": "chat-nodejs.dev.gbksoft.net",  "port": "28781", "path": "/front_space" },
    "test": { "proto": "socket.io", "host": "chat-nodejs.test.gbksoft.net", "port": "28782", "path": "/front_space" },
    "live": { "proto": "socket.io", "host": "chat-nodejs.live.gbksoft.net", "port": "28783", "path": "/front_space" }
  },

  "user_" : {
    "pavlo"   : { "username": "pavlo",    "password": "pavlo" },
    "roman"   : { "username": "roman",    "password": "roman" },
    "alexr"   : { "username": "alexr",    "password": "alexr" },
    "olexandr": { "username": "olexandr", "password": "olexandr" },
    "petr"    : { "username": "petr",     "password": "petr" }
  },

  "scenarios": [
    {
      "name": "send user message",
      "parameters": [
        {
          "name": "messageText",
          "in"  : "2_send_message_messageText"
        },


      ],
      "data": [
        { 
          "action"  : "process.expect",
          "wait"    : { "delay": 30000 }, 
          "expected": { "slaveIsReady": { "slaveUserId": "{{!slaveUserId}}" } },
          "dataOut" : [ ["{{doer.socket_io}}", "doer.socket_io"] ]
        },

        { 
          "action": "exec.execAsync",
          "dataIn": [ ["alexr", "user.username"], ["alexr", "user.password"] ],
          "data"  : [
            { 
              "action"  : "call.callWsaggerFile",
              "wait"    : { "delay": 30000 }, 
              "data"    : "login_and_connect.wsagger.json",
              "expected": { "doer.socket_io": {} },
              "dataOut" : [ ["{{doer.socket_io}}", "doer.socket_io"], ["{{userId}}", "slaveUserId"] ]
            },

            {
              "action"  : "process.emit",
              "data"    : ["slaveIsReady", { "slaveUserId": "{{slaveUserId}}" }]
            },
          
            { 
              "action"  : "socket_io.expect",
              "expected": [[ "messageUser", { "messageText": "{{!messageTextReceived}}"} ]], 
              "wait"    : { "delay": 5000 },
              "dataOut" : [ ["{{messageTextReceived}}", "messageTextReceived"] ]
            } 
          ],          
          "expected": { "messageTextReceived": "{{messageText}}" }
        },

        { 
          "action"  : "call.callWsaggerFile",
          "wait"    : { "delay": 30000 }, 
          "data"    : "login_and_connect.wsagger.json",
          "expected": { "doer.socket_io": {} },
          "dataOut" : [ ["{{doer.socket_io}}", "doer.socket_io"] ]
        }, 

        {
          "action"  : "socket_io.emit",
          "data"    : ["sendMessage", { "type": "user", "messageText": "{{messageText}}", "userId": "{{slaveUserId}}" }],
          "expected": [[ "messageUser", { "messageText": "{{messageText}}"} ]], 
          "wait"    : { "delay": 3000 }
        }
      ]
    }
  ]
}
