{
  "wsagger": "0.0.3",
  "info": {
    "description": "GBKSOFT chat API",
    "version": "1.1.0",
    "title": "GBKSOFT chat API"
  },

  "_variants": {

   "REST_" : {
      "loc":  { "proto": "https", "host": "tickertocker-php-backend.ory.gbksoft.net",  "port": "443", "path": "/api" },
      "dev":  { "proto": "https", "host": "tickertocker-php-backend.ory.gbksoft.net",  "port": "443", "path": "/api" }
   },

   "server_" : {
      "loc":  { "proto": "http", "host": "localhost",                                    "port": "28890", "path": "/front_space" },
      "dev":  { "proto": "http", "host": "tickertocker-nodejs-backend.ory.gbksoft.net",  "port": "28890", "path": "/front_space" }
   },

   "user_" : {
      "1"  : { "username": "admin@example.com", "password": "DjhjuYtDuflf'!"}

   }

  },


  "name": "login and connect",

  "keysIn": ["REST.proto", "REST.host", "REST.port", "REST.path", "user.username", "user.password", "server.proto", "server.host",  "server.port", "server.path"], 

  "data": [
  
    { 
      "action": "https.request",
      "data": {
        "method": "POST", 
        "host": "{{REST.host}}", 
        "port": "{{REST.port}}", 
        "path": "{{REST.path}}/v1/user/login", 
        "headers": {"Content-Type": "application/x-www-form-urlencoded", "Accept": "application/json"},
        "queryData":"email={{user.username}}&password={{user.password}}"
      },          
   
      "expected": { "parsed": {"result": { "id": "{{!userId}}", "token": "{{!token}}"}}},
      "wait": {"delay": 5000} 
    },

    {
      "action": "socket_io.connect",           
      "data": { 
        "url": "http://{{server.host}}:{{server.port}}{{server.path}}",            
        "query": { "query": "token={{token}}" }
      },
      "wait": {"delay": 3000},
      "expected": [[ "connectedTo", {}]]
    }

  ],
          
  "dataOut": [ "doer.socket_io", "userId" ]
}
