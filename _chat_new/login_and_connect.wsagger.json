{
   "wsagger": "0.0.3",
   "info": {
      "description": "GBKSOFT chat API",
      "version": "1.1.0",
      "title": "GBKSOFT chat API"
   },

   "name": "login_and_connect",

   "keysIn": ["REST.proto", "REST.host", "REST.port", "REST.path", "user.username", "user.password", "server.proto", "server.host",  "server.port", "server.path"], 

          "data": [
             { 
                "action": "http.request",
                "data": {
                   "method": "POST", 
                   "host": "{{REST.host}}", 
                   "port": "{{REST.port}}", 
                   "path": "{{REST.path}}/v1/user/login", 
                   "headers": {"Content-Type": "application/x-www-form-urlencoded", "Accept": "application/json"},
                   "queryData":"username={{user.username}}&password={{user.password}}"
                },          
                "expected": { "result": { "id": "{{!userId}}", "token": "{{!token}}"}},
                "wait": {"delay": 5000} 
             },

             {
                "action": "socket_io.connect",           
                "data": { 
                   "url": "http://{{server.host}}:{{server.port}}{{server.path}}",            
                   "query": { "query": "token={{token}}" }
                },
                "wait": {"delay": 3000},
                "expected": [[ "connected", {}]]
             }

          ],
          
          "dataOut": [ "doer.socket_io", "userId" ]
}
